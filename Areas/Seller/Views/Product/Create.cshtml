@model ProductModel
@{
    ViewData["title"] = "Create Product";
}
<div class="container-fluid">
<h3 class="page-title">Thêm mới sản phẩm</h3>
    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-3">
                </div>
                <!-- /.col -->
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Thông tin thêm sản phẩm mới</h3>
                        </div>
                        <div class="card-header p-2">
                            <ul class="nav nav-pills">
                                <li class="nav-item"><a class="nav-link active" href="#activity" data-toggle="tab">Thông tin chung</a></li>
                                <li class="nav-item"><a class="nav-link" href="#timeline" data-toggle="tab">Hình ảnh</a></li>
                                <li class="nav-item"><a class="nav-link" href="#settings" data-toggle="tab">SEO </a></li>
                            </ul>
                        </div><!-- /.card-header -->
                        <form asp-action="Create" enctype="multipart/form-data">
                            <div class="card-body">
                                <div class="tab-content">
                                    <div class="active tab-pane" id="activity">
                                        <!-- Post -->
                                        <div class="form-wrapper">
                                            <div class="form-container col-md-12">
                                                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                                <div class="form-group">
                                                    <label for="Name">Tên sản phẩm</label>
                                                    <input asp-for="Name" class="form-control" id="Name" />
                                                    <span asp-validation-for="Name" class="text-danger" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="Price">Giá</label>
                                                    <input asp-for="Price" class="form-control" id="Price" />
                                                    <span asp-validation-for="Price" class="text-danger" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="DiscountPercentage">Giảm giá (%)</label>
                                                    <input asp-for="DiscountPercentage" type="number" step="0.01" min="0" max="100" class="form-control" id="DiscountPercentage" />
                                                    <span asp-validation-for="DiscountPercentage" class="text-danger" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="Description">Mô tả</label>
                                                    <textarea asp-for="Description" class="form-control" id="Description"></textarea>
                                                    <span asp-validation-for="Description" class="text-danger" />
                                                </div>

                                                <div class="form-group">
                                                    <label for="CategoryId">Phân loại</label>
                                                    <select asp-for="CategoryId" class="form-control" id="CategoryId" asp-items="ViewBag.Categories">
                                                        <option value="">--Chọn Phân Loại--</option>
                                                    </select>
                                                    <span asp-validation-for="CategoryId" class="text-danger" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="BrandId">Thương hiệu</label>
                                                    <select asp-for="BrandId" class="form-control" id="BrandId" asp-items="ViewBag.Brands">
                                                        <option value="">--Chọn Thương Hiệu--</option>
                                                    </select>
                                                    <span asp-validation-for="BrandId" class="text-danger" />
                                                </div>

                                                <div class="form-group">
                                                    <label for="Size">Size (ví dụ X, XL, XXL; 40, 41, 42)</label>
                                                    <input asp-for="Size" class="form-control" id="Size" />
                                                    <span asp-validation-for="Size" class="text-danger" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="Color">Màu (ví dụ: Đỏ, Đen; Xanh, Vàng)</label>
                                                    <input asp-for="Color" class="form-control" id="Color" />
                                                    <span asp-validation-for="Color" class="text-danger" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="StockQuantity">Tồn kho</label>
                                                    <input asp-for="StockQuantity" type="number" class="form-control" id="StockQuantity" />
                                                    <span asp-validation-for="StockQuantity" class="text-danger" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="Dimensions">Kích thước (Ví dụ: 30x30x30 cm)</label>
                                                    <input asp-for="Dimensions" class="form-control" id="Dimensions" />
                                                    <span asp-validation-for="Dimensions" class="text-danger" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="Weight">Trọng lượng (Ví dụ: 2.5 kg)</label>
                                                    <input asp-for="Weight" class="form-control" id="Weight" />
                                                    <span asp-validation-for="Weight" class="text-danger" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="Material">Chất liệu</label>
                                                    <input asp-for="Material" class="form-control" id="Material" />
                                                    <span asp-validation-for="Material" class="text-danger" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="Specifications">Thông số KT</label>
                                                    <textarea asp-for="Specifications" class="form-control" id="Specifications"></textarea>
                                                    <span asp-validation-for="Specifications" class="text-danger" />
                                                </div>
                                                <div class="row">
                                                    <div class="col-4">
                                                        <div class="form-group">
                                                            <label for="Express">Hỏa tốc</label>
                                                            <div class="form-check">
                                                                <input asp-for="Express" type="checkbox" class="form-check-input" id="Express" />
                                                                <label class="form-check-label" for="Express">Có</label>
                                                            </div>
                                                            <span asp-validation-for="Express" class="text-danger" />
                                                        </div>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="form-group">
                                                            <label for="Save">Tiết kiệm</label>
                                                            <div class="form-check">
                                                                <input asp-for="Save" type="checkbox" class="form-check-input" id="Save" />
                                                                <label class="form-check-label" for="Save">Có</label>
                                                            </div>
                                                            <span asp-validation-for="Save" class="text-danger" />
                                                        </div>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="form-group">
                                                            <label for="Fast">Nhanh</label>
                                                            <div class="form-check">
                                                                <input asp-for="Fast" type="checkbox" class="form-check-input" id="Fast" />
                                                                <label class="form-check-label" for="Fast">Có</label>
                                                            </div>
                                                            <span asp-validation-for="Fast" class="text-danger" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="CategorySubId">Danh mục con</label>
                                                    <select asp-for="CategorySubId" class="form-control" id="CategoryId" asp-items="ViewBag.Categorysubs">
                                                        <option value="">--Chọn Danh Mục--</option>
                                                    </select>
                                                    <span asp-validation-for="CategorySubId" class="text-danger" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /.tab-pane -->
                                    <div class="tab-pane" id="timeline">
                                        <!-- The timeline -->
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>Hình ảnh</label>
                                                    <input asp-for="ImageUpLoads" type="file" class="form-control-file" id="ImageUpLoad" multiple />
                                                    <span asp-validation-for="ImageUpLoads" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <table class="table table-hover" id="imageTable">
                                                    <thead>
                                                        <tr>
                                                            <th class="text-center">Stt</th>
                                                            <th class="text-center">Ảnh</th>
                                                            <th class="text-center">Ảnh đại diện</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <!-- Các hình ảnh sẽ được thêm vào đây -->
                                                    </tbody>
                                                </table>
                                                <input type="hidden" name="DefaultImageIndex" value="0" />
                                            </div>
                                        </div>

                                        <!-- /.row -->
                                    </div>
                                    <!-- /.tab-pane -->
                                    <div class="tab-pane" id="settings">
                                        <!-- Settings tab content -->
                                    </div>
                                    <!-- /.tab-pane -->
                                </div>
                                <!-- /.tab-content -->
                            </div>
                            <!-- /.card-body -->
                            <div class="card-footer">
                                <button type="submit" class="btn btn-primary">Tạo sản phẩm</button>
                            </div>
                        </form>

                        <a asp-action="Index" class="btn btn-secondary mt-3">Trở về danh sách sản phẩm</a>
                    </div>
                    <!-- /.card -->
                </div>
                <!-- /.col -->
            </div>
            <!-- /.row -->
        </div><!-- /.container-fluid -->
    </section>

</div>
@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>

    <script>
        // Khởi tạo CKEditor cho các trường mô tả và thông số kỹ thuật
        CKEDITOR.replace('Description');
        CKEDITOR.replace('Specifications');

        // Xử lý sự kiện thay đổi khi chọn tệp
        $(document).ready(function () {
            let imageIndex = 0;

            $('#ImageUpLoad').on('change', function () {
                const files = this.files;

                $('#imageTable tbody').empty(); // Xóa bảng trước khi thêm ảnh mới

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        const newRow = `
                            <tr data-index="${imageIndex}">
                                <td class="text-center stt">${imageIndex + 1}</td>
                                <td class="text-center">
                                    <img src="${e.target.result}" class="img-thumbnail" width="100" />
                                </td>
                                <td class="text-center">
                                    <input type="radio" name="IsDefault" value="${imageIndex}" />
                                </td>
                                
                            </tr>`;

                        $('#imageTable tbody').append(newRow);
                        imageIndex++;
                        updateSTT();
                    };

                    reader.readAsDataURL(file); // Đọc tệp dưới dạng URL dữ liệu base64
                }
            });

            $(document).on('change', 'input[name="IsDefault"]', function () {
                // Lấy chỉ số ảnh mà người dùng chọn làm mặc định
                var selectedDefaultIndex = $(this).val();
                // Đặt giá trị vào input hidden để gửi về server
                $('input[name="DefaultImageIndex"]').val(selectedDefaultIndex);
            });

            function updateSTT() {
                $('#imageTable tbody tr').each(function (index) {
                    $(this).find('.stt').text(index + 1);
                });
            }
        });


    </script>
}
